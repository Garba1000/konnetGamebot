<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GameHub ‚Äî Play & Earn</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"/>

<!-- AdsGram SDK -->
<script src="https://sad.adsgram.ai/js/sad.min.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#0b0b0b;
  --panel:#121212;
  --muted:#9aa0a6;
  --accent:#1e90ff;
  --gold:#ffc107;
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box;font-family:Inter,Roboto,system-ui,-apple-system,Segoe UI,Arial; color:#fff;}
body{margin:0;background:linear-gradient(180deg,var(--bg),#050505);min-height:100vh;padding:18px;display:flex;flex-direction:column;align-items:center;}
header{width:100%;max-width:980px;display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
h1{font-size:22px;color:var(--accent);margin:0}
.stats{display:flex;gap:12px}
.card{background:var(--panel);padding:12px 16px;border-radius:10px;min-width:110px;text-align:center;box-shadow:0 4px 16px rgba(0,0,0,0.5)}
.card h2{font-size:18px;margin:0;color:var(--gold)}
.card p{color:var(--muted);font-size:13px;margin:6px 0 0}
main{width:100%;max-width:980px;display:flex;gap:14px;align-items:flex-start;justify-content:center;flex-wrap:wrap}
.panel{background:var(--panel);border-radius:12px;padding:16px;width:100%;box-shadow:0 6px 24px rgba(0,0,0,0.6)}
.left{flex:1;min-width:320px;max-width:620px}
.right{width:320px;min-width:280px}
.task-area{margin-top:12px;padding:12px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.02)}
.row{display:flex;gap:8px;align-items:center;margin-top:12px;flex-wrap:wrap}
.btn{padding:10px 12px;border-radius:10px;border:none;cursor:pointer}
.btn.primary{background:var(--accent);color:#fff}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff}
.btn.game {background: var(--accent); color:#fff; font-weight:700; display:flex; align-items:center; gap:8px; transition: transform 0.2s, box-shadow 0.2s;}
.btn.game i {font-size:18px;}
.btn.game:hover {transform: translateY(-3px); box-shadow:0 8px 20px rgba(30,144,255,0.5);}
.compact{padding:12px;border-radius:10px;background:linear-gradient(180deg,#0f0f0f,#0b0b0b)}
.compact h4{margin:0 0 8px 0;color:var(--gold)}
.small{font-size:13px;color:var(--muted)}
.drawer{position:fixed;right:18px;bottom:18px;background:var(--panel);padding:14px;border-radius:12px;width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.6);display:none}
input, select, textarea{width:100%;padding:8px;border-radius:8px;border:none;background:#0a0a0a;color:#fff;margin-bottom:8px}
.requests{max-height:240px;overflow:auto;margin-top:8px;border-top:1px dashed rgba(255,255,255,0.02);padding-top:8px}
footer{margin-top:20px;color:var(--muted);font-size:13px;text-align:center}
.claim-big{display:none;margin-top:12px;padding:14px;border-radius:12px;background:linear-gradient(90deg,var(--accent),#0050ff);color:#fff;border:none;font-weight:700;font-size:16px;cursor:pointer}

/* I Won / I Lost buttons */
#gameControls {display:flex; gap:12px; margin-top:12px; justify-content:center;}
#gameControls button {flex:1; padding:10px; font-weight:700; border-radius:10px; border:none; cursor:pointer; color:#fff; background:var(--accent); transition:0.2s;}
#gameControls button:hover {opacity:0.8;}

/* Full-page Join Overlay */
#joinOverlay {
  position:fixed; top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.95);
  z-index:9999;
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
}
#joinOverlay button{
  padding:16px 28px;
  font-size:18px;
  font-weight:bold;
  border:none;
  border-radius:12px;
  background:var(--accent);
  color:#fff;
  cursor:pointer;
}

iframe.game-frame {width:100%; height:400px; border:none; border-radius:10px; margin-top:12px;}
</style>
</head>
<body>
<header>
<h1>GameHub ‚Äî Play & Earn</h1>
<div class="stats">
  <div class="card"><h2 id="points">0</h2><p>Points</p></div>
  <div class="card"><h2 id="earned">$0.000</h2><p>Earned</p></div>
</div>
</header>

<main>
<div class="panel left">
  <div class="task-area">
      <strong>Choose a game to play</strong>
      <div class="row">
        <button id="playSubway" class="btn game"><i class="fas fa-running"></i> Subway Surfers</button>
        <button id="playHappy" class="btn game"><i class="fas fa-smile"></i> Happy Wheels</button>
        <button id="playGeometry" class="btn game"><i class="fas fa-cube"></i> Geometry Dash</button>
        <button id="playMonster" class="btn game"><i class="fas fa-truck"></i> Monster Truck</button>
        <button id="playTemple" class="btn game"><i class="fas fa-archway"></i> Temple Run</button>
        <button id="playZombie" class="btn game"><i class="fas fa-skull-crossbones"></i> Stupid Zombie</button>
        <button id="playStack" class="btn game"><i class="fas fa-layer-group"></i> Stack Bounce</button>
        <button id="playTunnel" class="btn game"><i class="fas fa-wind"></i> Tunnel Rush</button>
        <button id="playPacman" class="btn game"><i class="fas fa-ghost"></i> Pac-Man</button>
      </div>

      <!-- iframe for game -->
      <iframe id="gameFrame" class="game-frame"></iframe>

      <!-- I Won / I Lost buttons -->
      <div id="gameControls">
        <button id="wonBtn">I Won</button>
        <button id="lostBtn">I Lost</button>
      </div>

      <div style="margin-top:12px">
        <button id="taskButton" class="btn primary">Task & Earn Points</button>
        <button id="claimButton" class="btn primary">Claim Points</button>
      </div>

      <div id="adsWrapper" style="display:none; margin-top:10px;"></div>
      <button id="claimButtonBig" class="claim-big">Claim More Points</button>
  </div>
</div>

<div class="panel right">
  <div class="compact">
    <h4>Your Referral</h4>
    <div class="small">Your ID: <strong id="userIdDisplay">-</strong></div>
    <div class="small">Referrer: <strong id="referrerDisplay">-</strong></div>
    <div style="margin-top:8px">
      <div class="small">Referral bonus: <strong>20%</strong> of referral earnings</div>
    </div>
    <button id="copyReferral" class="btn primary" style="margin-top:8px;">Copy Referral</button>
  </div>

  <div class="compact" style="margin-top:12px">
    <h4>Pending Referral Payouts (outbox)</h4>
    <div id="refOutbox" class="small muted">No pending referral payouts yet.</div>
  </div>

  <div class="compact" style="margin-top:12px">
    <div id="requests" class="requests"></div>
  </div>

  <button id="withdrawOpen" class="btn primary" style="margin-top:12px;">Withdraw</button>
</div>
</main>

<footer><div class="small">Tip: Complete tasks and play games to earn points and withdraw.</div></footer>

<div class="drawer" id="drawer">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
    <strong>Withdraw (min $6)</strong>
    <button id="closeDrawer" class="btn ghost"><i class="fa fa-xmark"></i></button>
  </div>

  <label>Amount (USD)</label>
  <input id="wdAmount" type="number" min="6" step="0.01" />

  <label>Method</label>
  <select id="wdMethod">
    <option value="payeer">Payeer</option>
    <option value="skrill">Skrill</option>
    <option value="usdt">USDT</option>
    <option value="bank">Bank Transfer</option>
  </select>

  <label>Details (wallet / account)</label>
  <textarea id="wdDetails" rows="3" placeholder="e.g., PAYEER_EMAIL or USDT address"></textarea>

  <div style="display:flex;gap:8px;margin-top:8px">
    <button id="submitWd" class="btn primary">Send Request</button>
    <button id="cancelWd" class="btn ghost">Cancel</button>
  </div>
</div>

<!-- FULL PAGE JOIN OVERLAY -->
<div id="joinOverlay">
  <h2 style="margin-bottom:16px;">üö´ You must join our channel to continue</h2>
  <button onclick="joinAndContinue()">üëâ Join Telegram Channel</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();
tg.enableClosingConfirmation();

const TASK_BLOCKS = ["task-21431","task-21432","task-21436","task-21433","task-21434"];
const REWARD_BLOCKS = ["22795","22796","22797","22798","22799","22800","22801","22802"];

let points = parseInt(localStorage.getItem("points")||0);
let earned = parseFloat(localStorage.getItem("earned")||0);
const POINT_TO_DOLLAR = 0.02/100;

const pointsEl=document.getElementById("points");
const earnedEl=document.getElementById("earned");
const adsWrapper=document.getElementById("adsWrapper");
const taskButton=document.getElementById("taskButton");
const claimButton=document.getElementById("claimButton");
const claimButtonBig=document.getElementById("claimButtonBig");
const gameFrame = document.getElementById("gameFrame");

// Game URLs
const games = {
  "playSubway": "https://freeonlinegames.github.io/subway-surfers-tokyo/",
  "playHappy": "https://games-online.io/game/HappyWheels/",
  "playGeometry": "https://freeonlinegames.github.io/geometry-dash.html",
  "playMonster": "https://szhong.4399.com/4399swf//upload_swf/ftp35/chenling/20210303/1/index.html",
  "playTemple": "https://sda.4399.com/4399swf//upload_swf/ftp36/liuxinyu/20210628/jjjj1/index.html",
  "playZombie": "https://g.vseigru.net/6/igra-tupye-zombi/",
  "playStack": "https://cdn.gamesnacks.com/stackbounceupdate/gameCode/index.html",
  "playTunnel": "https://ubg100.github.io/games/tunnelrush/index.html",
  "playPacman": "https://bward2.github.io/pacman-js/"
};

// Update UI & localStorage
function updateUI(){
  pointsEl.textContent=points;
  earnedEl.textContent="$"+earned.toFixed(3);
  claimButtonBig.style.display=points<=0?"block":"none";
}
function saveAll(){
  localStorage.setItem("points",points);
  localStorage.setItem("earned",earned);
}

// --- TASK BLOCKS FUNCTION ---
function createAdsTask(callback, taskCount=1, reward=100){
    adsWrapper.innerHTML="";
    let tasksDone=0;
    function nextTask(){
        if(tasksDone>=taskCount){
            points += reward;
            earned += reward*POINT_TO_DOLLAR;
            saveAll();
            updateUI();
            if(callback) callback();
            adsWrapper.style.display="none";
            return;
        }
        const el=document.createElement("adsgram-task");
        el.setAttribute("data-block-id", TASK_BLOCKS[Math.floor(Math.random()*TASK_BLOCKS.length)]);
        el.addEventListener("reward", ()=>{
            tasksDone++;
            nextTask();
        });
        adsWrapper.appendChild(el);
        adsWrapper.style.display="block";
        if(typeof el.load==="function") el.load();
    }
    nextTask();
}

// --- REWARD BLOCKS (run only while playing game) ---
let rewardInterval = null;
function startRewardInterval(){
    if(rewardInterval) clearInterval(rewardInterval);
    rewardInterval = setInterval(()=>{
        const el = document.createElement("adsgram-task");
        el.setAttribute("data-block-id", REWARD_BLOCKS[Math.floor(Math.random()*REWARD_BLOCKS.length)]);
        el.addEventListener("reward", ()=>{
            points += 100;
            earned += 100*POINT_TO_DOLLAR;
            saveAll();
            updateUI();
        });
        el.style.display="none"; // hidden reward
        document.body.appendChild(el);
        if(typeof el.load==="function") el.load();
    },30000);
}

// --- GAME BUTTON CLICK ---
Object.keys(games).forEach(id=>{
    document.getElementById(id).addEventListener("click", ()=>{
        gameFrame.src = games[id];
        startRewardInterval(); // start reward while playing

        // preload one reward ad silently
        const preload = document.createElement("adsgram-task");
        preload.setAttribute("data-block-id", REWARD_BLOCKS[Math.floor(Math.random()*REWARD_BLOCKS.length)]);
        preload.style.display="none";
        document.body.appendChild(preload);
        if(typeof preload.load==="function") preload.load();
    });
});

// --- TASK/TRIGGER BUTTONS ---
taskButton.addEventListener("click", ()=> createAdsTask(null,1,100));
claimButton.addEventListener("click", ()=> createAdsTask(null,1,100));
claimButtonBig.addEventListener("click", ()=> createAdsTask(null,1,100));
document.getElementById("wonBtn").addEventListener("click", ()=> createAdsTask(null,4,100));
document.getElementById("lostBtn").addEventListener("click", ()=> createAdsTask(null,1,50));

// --- JOIN OVERLAY ---
function joinAndContinue(){
    const rewardId = REWARD_BLOCKS[Math.floor(Math.random()*REWARD_BLOCKS.length)];
    const ad = document.createElement("adsgram-task");
    ad.setAttribute("data-block-id", rewardId);
    ad.style.display="none";
    document.body.appendChild(ad);
    if(typeof ad.load==="function") ad.load();

    window.open("https://t.me/Konnetearnchannel","_blank");
    if(!localStorage.getItem("joinedRewardGiven")){
        points+=10;
        saveAll();
        updateUI();
        localStorage.setItem("joinedRewardGiven","yes");
        alert("üéâ Thanks for joining! +10 points");
    }
    document.getElementById("joinOverlay").style.display="none";
}

// --- REFERRAL & WITHDRAW ---
document.getElementById("copyReferral").addEventListener("click",()=>{
  const uid=tg.initDataUnsafe?.user?.id||"unknown";
  navigator.clipboard.writeText(`https://t.me/Listensmusicbot?start=${uid}`);
  tg.showAlert("‚úÖ Referral link copied!");
});
document.getElementById("withdrawOpen").addEventListener("click",()=>drawer.style.display="block");
document.getElementById("closeDrawer").addEventListener("click",()=>drawer.style.display="none");
document.getElementById("cancelWd").addEventListener("click",()=>drawer.style.display="none");
document.getElementById("submitWd").addEventListener("click",()=>{
  const amount=parseFloat(document.getElementById("wdAmount").value);
  const method=document.getElementById("wdMethod").value;
  const details=document.getElementById("wdDetails").value.trim();
  if(!amount||amount<6)return tg.showAlert("‚ùå Minimum withdraw is $6.");
  if(amount>earned)return tg.showAlert(`‚ùå You only have $${earned.toFixed(3)} available.`);
  if(!details)return tg.showAlert("‚ùå Please enter your wallet or account.");
  earned-=amount;
  saveAll();
  updateUI();
  const msg=`üì§ *Withdraw Request*
üë§ User ID: ${tg.initDataUnsafe?.user?.id}
üíµ Amount: $${amount}
üè¶ Method: ${method.toUpperCase()}
üîó Wallet/Account: ${details}
üí∞ Remaining Balance: $${earned.toFixed(3)}
‚≠ê Remaining Points: ${points}`;
  Api.sendMessage({chat_id:6136849497,text:msg,parse_mode:"Markdown"});
  tg.showAlert("‚úÖ Withdraw request sent!");
  drawer.style.display="none";
});

updateUI();
</script>
</body>
</html>
